@model InventoryManagementApp.ViewModels.Inventory.InventoryCreateViewModel

@{
    var inventory = ViewData["Inventory"] as InventoryManagementApp.Models.Inventory;
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h5>Items</h5>

    @if (inventory == null)
    {
        <div class="alert alert-warning mb-0">
            Create an inventory first to manage items.
        </div>
    }
    else
    {
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addItemModal">
            Add Item
        </button>
    }
</div>

@if (inventory != null)
{
    <div id="itemsTableContainer">
        @await Html.PartialAsync("~/Views/InventoryItems/_ItemsTable.cshtml", inventory.Items, new ViewDataDictionary(ViewData) { { "Inventory", inventory } })
    </div>

    @await Html.PartialAsync("~/Views/InventoryItems/_AddItemModal.cshtml", Model, new ViewDataDictionary(ViewData) { { "Inventory", inventory } })
}

@section Scripts {
    <script>
        // table refreshing after adding 
        document.querySelector("#addItemModal form")?.addEventListener("submit", async function (e) {
            e.preventDefault();

            const form = e.target;
            const formData = new FormData(form);

            const response = await fetch(form.action, {
                method: "POST",
                body: formData
            });

            if (response.ok) {
                const html = await response.text();
                document.querySelector("#itemsTableContainer").innerHTML = html;

                const modal = bootstrap.Modal.getInstance(document.getElementById("addItemModal"));
                modal.hide();
                form.reset();
            } else {
                alert("Error while adding item.");
            }
        });
    </script>
}
