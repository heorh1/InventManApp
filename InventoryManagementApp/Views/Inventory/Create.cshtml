@model InventoryManagementApp.ViewModels.InventoryViewModels.InventoryCreateViewModel

@{
    ViewData["Title"] = "Create Inventory";
}

<h2>Create Inventory</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}

<form asp-action="Create" method="post">
    @Html.AntiForgeryToken()
    <div class="tab-container">
        <ul class="nav nav-tabs" id="inventoryTabs" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">Settings</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="customid-tab" data-bs-toggle="tab" data-bs-target="#customid" type="button" role="tab">Custom ID</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="fields-tab" data-bs-toggle="tab" data-bs-target="#fields" type="button" role="tab">Fields</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="access-tab" data-bs-toggle="tab" data-bs-target="#access" type="button" role="tab">Access</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="items-tab" data-bs-toggle="tab" data-bs-target="#items" type="button" role="tab">Items</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="chat-tab" data-bs-toggle="tab" data-bs-target="#chat" type="button" role="tab">Chat</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="stats-tab" data-bs-toggle="tab" data-bs-target="#stats" type="button" role="tab">Stats</button>
            </li>
        </ul>

        <div class="tab-content p-3 border border-top-0" id="inventoryTabsContent">
            @await Html.PartialAsync("CreateTabs/_Settings", Model)
            @await Html.PartialAsync("CreateTabs/_CustomId", Model)
            @await Html.PartialAsync("CreateTabs/_Fields", Model)
            @await Html.PartialAsync("CreateTabs/_Access", Model)

            <div class="tab-pane fade @((ViewBag.ActiveTab == "items") ? "show active" : "")" id="items">
                @if (Model.InventoryId.HasValue)
                {
                    var addItemModel = new InventoryManagementApp.ViewModels.InventoryViewModels.AddItemViewModel
                    {
                        InventoryId = Model.InventoryId.Value
                    };
                    ViewBag.Structure = Model;
                    @await Html.PartialAsync("CreateTabs/_Items", addItemModel)
                }
                else
                {
                    <p>Please save the inventory first to add items.</p>
                }
            </div>
            @await Html.PartialAsync("CreateTabs/_Chat", Model)
            @await Html.PartialAsync("CreateTabs/_Stats", Model)
        </div>
    </div>
</form>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var activeTab = '@ViewBag.ActiveTab';
            if (activeTab) {
                var tab = new bootstrap.Tab(document.querySelector(`#${activeTab}-tab`));
                tab.show();
            }
        });
    </script>
}
